<!DOCTYPE html>
<html>

<head>
  <title>Job Queue</title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body>
  <h1>Job Queue</h1>
  <form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="videos" multiple>
    <button type="submit">Upload</button>
  </form>
  <ul>
    <% jobs.forEach(job => { %>
      <li id="job-<%= job._id %>">
        <%= job.filename %> - <span id="status-<%= job._id %>"><%= job.status %></span>
      </li>
    <% }); %>
  </ul>
  <script>
    function checkJobStatus(jobId) {
      setInterval(() => {
        fetch(`/status/${jobId}`)
          .then(response => response.json())
          .then(data => {
            const statusElement = document.getElementById(`status-${jobId}`);
            if (statusElement) {
              statusElement.textContent = data.status;
            }
          })
          .catch(error => console.error('Error fetching job status:', error));
      }, 5000); 
    }

    document.addEventListener('DOMContentLoaded', () => {
      <% jobs.forEach(job => { %>
        checkJobStatus('<%= job._id %>');
      <% }); %>
    });
  </script>
</body>

</html>
